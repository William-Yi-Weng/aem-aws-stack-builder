version: 0.2

phases:
  pre_build:
    commands:
      - echo -e 'Creating aws resources....'
      - rm -f $CONFIG_FILE
      - make deps
      - make deps-test
      - echo -e "aws:\n  resources:\n    s3_bucket:\t${BUILD_ID}-res" > $CONFIG_FILE
      - cp $CONFIG_FILE $WORK_DIR

  build:
    commands:
      - make create-aws-resources "stack_prefix=${BUILD_ID}-res" "config_path=${WORK_DIR}"

  post_build:
    commands:
      - make delete-aws-resources "stack_prefix=${BUILD_ID}-res" "config_path=${WORK_DIR}"


